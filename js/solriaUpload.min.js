(function(e){e.fn.solriaUpload=function(r){var i={dragMode:!1,dragText:"Drag and Drop your files here",btnText:"Browse files...",allowedExtensions:"",invalidExtError:"Invalid File Type",maxSize:0,sizeError:"Size of the file is greather than allowed",showPreview:!0,showFilename:!0,showPercent:!0,showErrorAlerts:!0,errorOnResponse:"There has been an error uploading your file",onSubmit:!1,url:"",data:null,limit:0,limitError:"You have reached the limit of files that you can upload",delfiletext:"Remove from queue",dragContainerCss:"well well-lg",uploadButtonCss:"btn btn-primary btn-upload",uploadButtonIconCss:"glyphicon glyphicon-upload",previewIconFileCss:"glyphicon glyphicon-file",onFileError:function(e,r){},onFileSuccess:function(e,r){}};r=e.extend(i,r);var n={obj:e(this),files:[],uparea:null,container:null,uploadedfiles:0,hasErrors:!1,init:function(){this.replacehtml(),this.uparea.on("click",function(){n.selectfiles()}),r.dragMode&&this.handledragevents(),this.handlebuttonevents(),e(document).on("click",".su-wrn-cl",function(){e(this).parent("div").remove()}),r.onSubmit&&this.handleFormSubmission()},replacehtml:function(){var i=null;switch(r.dragMode){case!0:i='<div class="'+r.dragContainerCss+' su-uparea su-dragarea" style="cursor:pointer"><h4>'+r.dragText+"</h4></div>";break;case!1:i='<a href="javascript:void(0)" class="su-uparea"> <i class="'+r.uploadButtonCss+" "+r.uploadButtonIconCss+'"></i> '+r.btnText+"</a>"}this.obj.hide(),this.uparea=e(i).insertAfter(this.obj),this.container=e('<div class="su-container"><ul></ul></div>').insertAfter(this.uparea)},selectfiles:function(){this.obj.click()},handlebuttonevents:function(){e(this.obj).on("change",this.obj.selector,function(){n.checkFile(n.obj[0].files[0])}),e(document).on("click",".su-del",function(){var r=e(this).parent("div").parent("div");n.delAndRearrange(r)})},handledragevents:function(){e(document).on("dragenter",function(e){this.stopDefaultEvent(e)}),e(document).on("dragover",function(e){this.stopDefaultEvent(e)}),e(document).on("drop",function(e){this.stopDefaultEvent(e)}),this.uparea.on("dragenter",function(r){this.stopDefaultEvent(r),e(this).css("border","2px solid #0B85A1")}),this.uparea.on("dragover",function(e){this.stopDefaultEvent(e)}),this.uparea.on("drop",function(r){e(this).css("border","2px dotted #0B85A1"),r.preventDefault();for(var i=r.originalEvent.dataTransfer.files,t=0;t<i.length;t++)n.checkFile(i[t])})},stopDefaultEvent:function(e){e.stopPropagation(),e.preventDefault()},checkFile:function(e){error=this.validateFile(e),error?(r.showErrorAlerts&&this.addWarning(error),this.hasErrors=!0,r.onFileError(e,error)):(this.files.push(e),this.files.length>r.limit&&r.limit>0?(this.files.splice(this.files.length-1,1),r.showErrorAlerts&&this.addWarning(r.limitError,this.obj),this.hasErrors=!0,r.onFileError(e,error)):(this.addRow(e),r.onSubmit===!1&&this.upload(e,this.files.length-1)))},addWarning:function(r,i){var n='<div class="alert alert-danger"><button type="button" class="close su-wrn-cl" data-dismiss="alert">&times;</button> '+r+"</div>";i?e(n).insertBefore(i):this.container.append(n)},validateFile:function(e){return this.checkExtension(e)?this.checkSize(e)?null:r.sizeError:r.invalidExtError},checkExtension:function(i){if(""===r.allowedExtensions)return!0;var n=i.name.split(".").pop().toLowerCase(),t=r.allowedExtensions.split("|");return e.inArray(n,t)!==-1},checkSize:function(e){return 0===r.maxSize||e.size<=r.maxSize},addRow:function(i){var n=this.files.length-1,t=null,o=null,s=null,a=null,l=null;t=e('<div class="row sr-rw" rel="'+n+'"></div>').appendTo(this.container),r.showPreview&&(o=e('<div class="col-lg-2 col-md-2 col-xs-4"></div>').appendTo(t),this.previewFile(o,i)),s=e('<div class="col-lg-8 col-md-8 col-xs-8"></div>').appendTo(t),r.showFilename&&s.append('<div class="filename">'+i.name+"</div>"),r.notAjax===!1&&(a=e('<div class="progress"><div class="su-uppbr progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;"></div></div>').appendTo(s),r.showPercent&&a.find("div.progress-bar").text("0%")),l=e('<div class="col-lg-2 col-md-2 col-xs-2"></div>').appendTo(t),e('<a href="javascript:void(0);" class="btn btn-danger su-del">'+r.delfiletext+"</a>").appendTo(l)},previewFile:function(i,n){var t=n.type.split("/")[0],o=null;switch(t){case"image":o=e('<img class="thumbnail" src="'+window.URL.createObjectURL(n)+'" height="64" />').appendTo(i);break;case"video":o=e('<video src="'+window.URL.createObjectURL(n)+'" width="100%" controls></video>').appendTo(i);break;case"audio":o=e('<audio src="'+window.URL.createObjectURL(n)+'" width="100%" controls></audio>').appendTo(i);break;default:o=e('<i class="'+r.previewIconFileCss+'"></i>').appendTo(i)}},upload:function(i,t){var o=new FormData;o.append(this.obj.attr("name"),i);for(var s in r.data)o.append(s,r.data[s]);e.ajax({url:r.url,type:"POST",data:o,dataType:"json",success:function(o){if(1===o||1===o.success)n.files[t]=null,e('div.row[rel="'+t+'"]').find(".su-uppbr").css("width","100%"),r.onFileSuccess(i,o);else{n.files.splice(t,1);var s=null;s=error in o?null:r.errorOnResponse,r.showErrorAlerts&&n.addWarning(s,e('div.row[rel="'+t+'"]')),e('div.row[rel="'+t+'"]').remove(),n.hasErrors=!0,r.onFileError(i,s)}},error:function(o,s,a){n.files.splice(t,1),r.showErrorAlerts&&n.addWarning(a,e('div.sr-rw[rel="'+t+'"]')),n.hasErrors=!0,r.onFileError(i,a),e('div.sr-rw[rel="'+t+'"]').remove()},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){n.handleProgress(e,t)},!1),myXhr},complete:function(){r.onSubmit&&(n.uploadedfiles++,n.uploadedfiles===n.files.length&&n.hasErrors===!1&&(n.obj.remove(),n.obj.parent("form").submit()))},cache:!1,contentType:!1,processData:!1})},handleProgress:function(i,n){if(i.lengthComputable){var t=(i.total,i.loaded,Number((100*i.loaded/i.total).toFixed(2))),o=e('div.sr-rw[rel="'+n+'"]').find(".su-uppbr");o.css("width",t+"%"),r.showPercent&&o.text(t+"%")}},handleFormSubmission:function(){var e=this.obj.parent("form");e.submit(function(){n.hasErrors=!1,n.uploadedfiles=0;for(var e=0;e<n.files.length;e++)if(n.files[e])n.upload(n.files[e],e);else if(n.uploadedfiles++,n.uploadedfiles===n.files.length&&n.hasErrors===!1)return n.obj.remove(),!0;return!1})},delAndRearrange:function(r){var i=r.attr("rel");n.files.splice(parseInt(i),1),r.remove(),n.container.find("div.sr-rw").each(function(r){e(this).attr("rel",r)})}};n.init()}})(jQuery);
